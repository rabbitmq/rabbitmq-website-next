<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-NSPM4RC');</script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="googlebot" content="NOODP" /><meta name="google-site-verification" content="nSYeDgyKM9mw5CWcZuD0xu7iSWXlJijAlg9rcxVOYf4" /><meta name="google-site-verification" content="6UEaC3SWhpGQvqRnSJIEm2swxXpM5Adn4dxZhFsNdw0" /><meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="viewport" name="viewport" /><link href="https://fonts.googleapis.com/css?family=Raleway:400,500,600,700" rel="stylesheet" /><link rel="stylesheet" href="/css/rabbit.css" type="text/css" /><link rel="stylesheet" href="/css/highlightjs_style.css" type="text/css" /><link rel="stylesheet" href="/css/rabbit-next.css" type="text/css" /><!--[if IE 6]>
      <link rel="stylesheet" href="/css/rabbit-ie6.css" type="text/css" />
      <![endif]--><link rel="icon" type="/image/vnd.microsoft.icon" href="/favicon.ico" /><link rel="stylesheet" href="/css/tutorial.css" type="text/css" /><script async="true" type="text/javascript" src="/js/site.js"></script><title> Negative Acknowledgements
 — RabbitMQ</title></head>
  <body id="nack"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NSPM4RC" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="outerContainer"><div class="container"><div class="rabbit-logo"><a href="/"><img src="/img/logo-rabbitmq.svg" alt="RabbitMQ" /></a></div><a class="btn menubtn" onclick="showHide()">Menu <img src="/img/carrot-down-white.svg" /></a><div class="mobilemenuicon" onclick="showHide()"><img src="/img/mobile-menu-icon.svg" /></div><div id="nav"><ul id="mainNav"><li><a href="/#features">Features</a></li><li><a href="/#getstarted">Get Started</a></li><li><a href="/#support">Support</a></li><li><a href="/#community">Community</a></li><li><a href="/documentation.html">Docs</a></li></ul></div></div><div class="nav-separator"></div><div id="innerContainer" class="container"><div id="left-content"><h1> Negative Acknowledgements
</h1>


<h2><a id="overview" class="anchor" href="#overview">Overview</a></h2>
<p>Consumers in AMQP 0-9-1 can choose to use <a href="/confirms.html">manual acknowledgements</a>
of deliveries.</p>
<p>The <a href="/specification.html">AMQP 0-9-1 specification</a> defines the <span class="code ">basic.reject</span>
method that allows clients to reject individual, delivered
messages, instructing the broker to either discard them or
requeue them. Unfortunately, <span class="code ">basic.reject</span>
provides no support for negatively acknowledging messages in
bulk.</p>
<p>To solve this, RabbitMQ supports the <span class="code ">basic.nack</span>
method that provides all the functionality of
<span class="code ">basic.reject</span> whilst also allowing for bulk
processing of messages.</p>
<h2><a id="usage" class="anchor" href="#usage">Usage</a></h2>
<p>To reject messages in bulk, clients set the <span class="code ">multiple</span> flag of the <span class="code ">basic.nack</span>
method to <span class="code ">true</span>. The broker will then reject all
unacknowledged, delivered messages up to and including the
message specified in the <span class="code ">delivery_tag</span> field of the <span class="code ">basic.nack</span> method. In this respect,
<span class="code ">basic.nack</span> complements the bulk acknowledgement semantics of <span class="code ">basic.ack</span>.</p>
<p>Negative acknowledgements work for both <a href="/consumers.html">long running consumers</a>
and polling-based ones (that use <span class="code ">basic.get</span>).</p>
<p>When a message is requeued, it will be placed to its original
position in its queue, if possible. If not (due to concurrent
deliveries and acknowledgements from other consumers when
multiple consumers share a queue), the message will be requeued
to a position closer to queue head.</p>
<h2><a id="examples" class="anchor" href="#examples">Examples</a></h2>
<h3><a id="java-examples" class="anchor" href="#java-examples">Java</a></h3>
<p>This Java client example rejects a single message consumed via polling (<span class="code ">basic.get</span>),
asking the broker to requeue it:</p>
<pre class="lang-java">
GetResponse gr = channel.basicGet("some.queue", false);
channel.basicNack(gr.getEnvelope().getDeliveryTag(), false, true);
</pre>

<p>This example rejects two messages with a single call to
the broker (the second argument on
<span class="code ">basicNack</span> is the <span class="code ">multiple</span> flag):</p>
<pre class="lang-java">
GetResponse gr1 = channel.basicGet("some.queue", false);
GetResponse gr2 = channel.basicGet("some.queue", false);
channel.basicNack(gr2.getEnvelope().getDeliveryTag(), true, true);
</pre><div id="help-and-feedback"><h2>Getting Help and Providing Feedback</h2><p>
                    If you have questions about the contents of this guide or
                    any other topic related to RabbitMQ, don't hesitate to ask them
                    on the <a href="https://groups.google.com/forum/#!forum/rabbitmq-users">RabbitMQ mailing list</a>.
                  </p></div><div id="contribute"><h2>Help Us Improve the Docs &lt;3</h2><p>
                    If you'd like to contribute an improvement to the site,
                    its source is <a href="https://github.com/rabbitmq/rabbitmq-website">available on GitHub</a>.
                    Simply fork the repository and submit a pull request. Thank you!
                  </p></div></div><div id="right-nav"><div id="in-this-section"><h4>In This Section</h4><ul>
     <li><a href="/admin-guide.html">Server Documentation</a></li>
     <li><a href="/clients.html">Client Documentation</a></li>
     <li><a href="/plugins.html">Plugins</a></li>
     <li><a href="/news.html">News</a></li>
     <li><a href="/protocol.html">Protocol</a></li>
     <li><a href="/extensions.html" class="selected">Our Extensions</a><ul>
       <li><a href="/confirms.html">Confirms</a></li>
       <li><a href="/consumer-cancel.html">Consumer Cancel</a></li>
       <li><a href="/consumer-prefetch.html">Consumer Prefetch</a></li>
       <li><a href="/consumer-priority.html">Consumer Priorities</a></li>
       <li><a href="/direct-reply-to.html">Direct reply-to</a></li>
       <li><a href="/connection-blocked.html">Blocked Connections</a></li>
       <li><a href="/nack.html" class="selected">basic.nack</a></li>
       <li><a href="/e2e.html">e2e bindings</a></li>
       <li><a href="/ae.html">Alternate Exchanges</a></li>
       <li><a href="/sender-selected.html">Sender Routing</a></li>
       <li><a href="/ttl.html">TTL</a></li>
       <li><a href="/dlx.html">Dead Lettering</a></li>
       <li><a href="/maxlength.html">Length Limit</a></li>
       <li><a href="/priority.html">Priority Queues</a></li>
       <li><a href="/validated-user-id.html">Validated User ID</a></li>
       <li><a href="/auth-notification.html">Auth Failure</a></li>
       <li><a href="/spec-differences.html">Spec Differences</a></li>
     </ul></li>
     <li><a href="/build.html">Building</a></li>
     
     <li><a href="/mpl.html">License</a></li>
   </ul></div></div></div><div class="clear"></div><div class="pageFooter"><div class="container"></div><div class="container"><div class="rabbit-logo"><a href="/"><img src="/img/logo-rabbitmq-white.svg" alt="RabbitMQ" /></a></div><ul class="footerNav"><li><a href="/#features">Features</a></li><li><a href="/#getstarted">Get Started</a></li><li><a href="/#support">Support</a></li><li><a href="/#community">Community</a></li><li><a href="/documentation.html">Docs</a></li></ul><p id="copyright">
          Copyright © 2007-2020 <a href="https://tanzu.vmware.com/">VMware</a>, Inc. or its affiliates. All rights reserved.
          <a href="https://pivotal.io/legal">Terms of Use</a>,
          <a href="https://pivotal.io/privacy-policy">Privacy</a> and
          <a href="/trademark-guidelines.html">Trademark Guidelines</a><br /><a id="teconsent"></a></p></div></div></div><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript">
        // code highlighting
        window.addEventListener("load", function() {
          const selectors = "pre.lang-bash, \
                             pre.lang-csharp, \
                             pre.lang-elixir, \
                             pre.lang-erlang, \
                             pre.lang-go, \
                             pre.lang-groovy, \
                             pre.lang-haskell, \
                             pre.lang-html, \
                             pre.lang-ini, \
                             pre.lang-java, \
                             pre.lang-javascript, \
                             pre.lang-json, \
                             pre.lang-makefile, \
                             pre.lang-objectivec, \
                             pre.lang-php, \
                             pre.lang-plaintext, \
                             pre.lang-powershell, \
                             pre.lang-python, \
                             pre.lang-ruby, \
                             pre.lang-swift, \
                             pre.lang-yaml, \
                             pre.lang-xml";
          document.querySelectorAll(selectors).forEach(function(el) {
            hljs.highlightBlock(el);
          });
        });
      </script></body>
</html>
