<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="73d8ba46-8c12-43f6-8c22-24aa21b8d93d" name="onetrust-data-domain" /><meta content="https://tags.tiqcdn.com/utag/vmware/microsites-privacy/prod/utag.js" name="microsites-utag" /><script src="https://d1fto35gcfffzn.cloudfront.net/assets/jquery-1.11.2.min.js"></script><script src="//www.vmware.com/files/templates/inc/utag_data.js"></script><script src="//tags.tiqcdn.com/utag/vmware/microsites-privacy/prod/utag.sync.js"></script><script>function OptanonWrapper() { { window.dataLayer.push({ event: 'OneTrustGroupsUpdated' }); } }</script><script src="/js/gtm.js"></script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="googlebot" content="NOODP" /><meta name="google-site-verification" content="nSYeDgyKM9mw5CWcZuD0xu7iSWXlJijAlg9rcxVOYf4" /><meta name="google-site-verification" content="6UEaC3SWhpGQvqRnSJIEm2swxXpM5Adn4dxZhFsNdw0" /><meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="viewport" name="viewport" /><link href="https://fonts.googleapis.com/css?family=Raleway:400,500,600,700" rel="stylesheet" /><link rel="stylesheet" href="/css/rabbit.css" type="text/css" /><link rel="stylesheet" href="/css/highlightjs_style.css" type="text/css" /><link rel="stylesheet" href="/css/rabbit-next.css" type="text/css" /><!--[if IE 6]>
      <link rel="stylesheet" href="/css/rabbit-ie6.css" type="text/css" />
      <![endif]--><link rel="icon" type="/image/vnd.microsoft.icon" href="/favicon.ico" /><link rel="stylesheet" href="/css/tutorial.css" type="text/css" /><script async="true" type="text/javascript" src="/js/site.js"></script><title> Configuring Defaults for RabbitMQ Cluster Operator
 — RabbitMQ</title></head>
  <body id="kubernetes/operator/configure-operator-defaults"><div id="outerContainer"><div class="container"><div class="rabbit-logo"><a href="/"><img src="/img/logo-rabbitmq.svg" alt="RabbitMQ" /></a></div><a class="btn menubtn" onclick="showHide()">Menu <img src="/img/carrot-down-white.svg" /></a><div class="mobilemenuicon" onclick="showHide()"><img src="/img/mobile-menu-icon.svg" /></div><div id="nav"><ul id="mainNav"><li><a href="/#features">Features</a></li><li><a href="/#getstarted">Get Started</a></li><li><a href="/#support">Support</a></li><li><a href="/#community">Community</a></li><li><a href="/documentation.html">Docs</a></li></ul></div></div><div class="nav-separator"></div><div id="innerContainer" class="container"><div id="left-content"><h1> Configuring Defaults for RabbitMQ Cluster Operator
</h1>


<h2><a id="overview" class="anchor" href="#overview">Overview</a></h2>
<p>This guide covers how to modify the default configuration of the <a href="./operator-overview.html">RabbitMQ Cluster Kubernetes Operator</a> in a Kubernetes cluster.</p>
<p>Environment variables used by the operator can be overridden in order to influence how the operator configures created RabbitmqClusters.
This can be useful when configuring the operator to automatically use RabbitMQ container images stored in a private registry.</p>
<h2><a id="parameters" class="anchor" href="#parameters">Configurable Parameters</a></h2>
<p>The following configuration options are available to be set:</p>
<table>
<tr>
<td>
Env. variable
</td>
<td>
Description
</td>
<td>
Effect when unset
</td>
</tr>
<tr>
<td>
OPERATOR_SCOPE_NAMESPACE
</td>
<td>
Namespace which the operator will reconcile and watch RabbitmqClusters (independent of installation namespace)
</td>
<td>
All namespaces are watched and reconciled
</td>
</tr>
<tr>
<td>
DEFAULT_RABBITMQ_IMAGE
</td>
<td>
RabbitMQ container image used for new RabbitmqCluster Pods where not explicitly set in <span class="code ">RabbitmqCluster.Spec.Image</span>
</td>
<td>
Operator uses the latest RabbitMQ container image available at time of release for new Pods
</td>
</tr>
<tr>
<td>
DEFAULT_USER_UPDATER_IMAGE
</td>
<td>
Vault sidecar container image used for new RabbitmqCluster Pods where not explicitly set in <span class="code ">RabbitmqCluster.Spec.SecretBackend.Vault.DefaultUserUpdaterImage</span>
</td>
<td>
Operator uses the latest sidecar container image available at time of release for new Pods
</td>
</tr>
<tr>
<td>
DEFAULT_IMAGE_PULL_SECRETS
</td>
<td>
Comma-separated list of imagePullSecrets to set by default on all RabbitmqCluster Pods where not explicitly set in <span class="code ">RabbitmqCluster.Spec.ImagePullSecrets</span>
</td>
<td>
New RabbitmqCluster Pods have no imagePullSecrets by default
</td>
</tr>
</table>

<hr />
<h2><a id="configuration" class="anchor" href="#configuration">Configuration</a></h2>
<p>In order to set these configuration parameters, you will need to edit the Deployment manifest of the operator.
This is the YAML manifest artefact released with every new version of the RabbitMQ Cluster Operator on GitHub.</p>
<p>If you already have the operator deployed, you can edit the manifest of the operator directly:</p>
<pre class="lang-bash">
kubectl -n rabbitmq-system edit deployment rabbitmq-cluster-operator
</pre>

<p>In the manifest, add the environment variables you wish to change. For example, to set the namespace scope of the operator:</p>
<pre class="lang-yaml">
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: rabbitmq-operator
    app.kubernetes.io/name: rabbitmq-cluster-operator
    app.kubernetes.io/part-of: rabbitmq
  name: rabbitmq-cluster-operator
  namespace: rabbitmq-system
spec:
  template:
    spec:
      containers:
      - command:
        - /manager
        env:
        - name: OPERATOR_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - <b>name: OPERATOR_SCOPE_NAMESPACE</b>
          <b>value: custom-namespace</b>
...
</pre>
<p>Upon saving, the operator Pod will be updated to use this configuration.
Note that future GitHub release artefacts will not have these changes that you make, and so you must remember
to add these changes every time you update the cluster operator.</p>
<p>You may consider using templating to add these variables in automatically; for example you can use a ytt overlay
such as:</p>
<p><span class="code ">values.yaml</span></p>
<pre class="lang-yaml">
#@ load("@ytt:overlay", "overlay")
#@ deployment = overlay.subset({"kind": "Deployment"})
#@ cluster_operator = overlay.subset({"metadata": {"name": "rabbitmq-cluster-operator"}})
#@overlay/match by=overlay.and_op(deployment, cluster_operator),expects="1+"
---
spec:
  template:
    spec:
      containers:
      #@overlay/match by=overlay.subset({"name": "operator"}),expects="1+"
      -
        #@overlay/match missing_ok=True
        env:
        - name: OPERATOR_SCOPE_NAMESPACE
          value: custom-namespace
</pre>
<p>Use this overlay when upgrading the operator to ensure your custom configuration is applied for the new version:</p>
<pre class="lang-bash">
ytt -f https://github.com/rabbitmq/cluster-operator/releases/latest/download/cluster-operator.yml -f values.yaml | kubectl apply -f -
</pre><div id="help-and-feedback"><h2>Getting Help and Providing Feedback</h2><p>
                    If you have questions about the contents of this guide or
                    any other topic related to RabbitMQ, don't hesitate to ask them
                    on the <a href="https://groups.google.com/forum/#!forum/rabbitmq-users">RabbitMQ mailing list</a>.
                  </p></div><div id="contribute"><h2>Help Us Improve the Docs &lt;3</h2><p>
                    If you'd like to contribute an improvement to the site,
                    its source is <a href="https://github.com/rabbitmq/rabbitmq-website">available on GitHub</a>.
                    Simply fork the repository and submit a pull request. Thank you!
                  </p></div></div><div id="right-nav"></div></div><div class="clear"></div><div class="pageFooter"><div class="container"></div><div class="container"><div class="rabbit-logo"><a href="/"><img src="/img/logo-rabbitmq-white.svg" alt="RabbitMQ" /></a></div><ul class="footerNav"><li><a href="/#features">Features</a></li><li><a href="/#getstarted">Get Started</a></li><li><a href="/#support">Support</a></li><li><a href="/#community">Community</a></li><li><a href="/documentation.html">Docs</a></li></ul><p id="copyright">
          Copyright © 2007-2022 <a href="https://tanzu.vmware.com/">VMware</a>, Inc. or its affiliates. All rights reserved.
          <a href="https://www.vmware.com/help/legal.html">Terms of Use</a> •
          <a href="https://www.vmware.com/help/privacy.html">Privacy</a> •
          <a href="/trademark-guidelines.html">Trademark Guidelines</a> •
          <a href="https://www.vmware.com/help/privacy/california-privacy-rights.html">Your California Privacy Rights</a> •
          <a class="ot-sdk-show-settings">Cookie Settings</a><br /><a id="teconsent"></a></p></div></div></div><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript">
        // code highlighting
        window.addEventListener("load", function() {
          const selectors = "pre.lang-bash, \
                             pre.lang-csharp, \
                             pre.lang-elixir, \
                             pre.lang-erlang, \
                             pre.lang-go, \
                             pre.lang-groovy, \
                             pre.lang-haskell, \
                             pre.lang-html, \
                             pre.lang-ini, \
                             pre.lang-java, \
                             pre.lang-javascript, \
                             pre.lang-json, \
                             pre.lang-makefile, \
                             pre.lang-objectivec, \
                             pre.lang-php, \
                             pre.lang-plaintext, \
                             pre.lang-powershell, \
                             pre.lang-python, \
                             pre.lang-ruby, \
                             pre.lang-swift, \
                             pre.lang-yaml, \
                             pre.lang-xml";
          document.querySelectorAll(selectors).forEach(function(el) {
            hljs.highlightBlock(el);
          });
        });
      </script></body>
</html>
