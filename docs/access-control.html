<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="73d8ba46-8c12-43f6-8c22-24aa21b8d93d" name="onetrust-data-domain" /><meta content="https://tags.tiqcdn.com/utag/vmware/microsites-privacy/prod/utag.js" name="microsites-utag" /><script src="https://d1fto35gcfffzn.cloudfront.net/assets/jquery-1.11.2.min.js"></script><script src="//www.vmware.com/files/templates/inc/utag_data.js"></script><script src="//tags.tiqcdn.com/utag/vmware/microsites-privacy/prod/utag.sync.js"></script><script>function OptanonWrapper() { { window.dataLayer.push({ event: 'OneTrustGroupsUpdated' }); } }</script><script src="/js/gtm.js"></script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="googlebot" content="NOODP" /><meta name="google-site-verification" content="nSYeDgyKM9mw5CWcZuD0xu7iSWXlJijAlg9rcxVOYf4" /><meta name="google-site-verification" content="6UEaC3SWhpGQvqRnSJIEm2swxXpM5Adn4dxZhFsNdw0" /><meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="viewport" name="viewport" /><link href="https://fonts.googleapis.com/css?family=Raleway:400,500,600,700" rel="stylesheet" /><link rel="stylesheet" href="./css/rabbit.css" type="text/css" /><link rel="stylesheet" href="./css/highlightjs_style.css" type="text/css" /><link rel="stylesheet" href="./css/rabbit-next.css" type="text/css" /><!--[if IE 6]>
      <link rel="stylesheet" href="./css/rabbit-ie6.css" type="text/css" />
      <![endif]--><link rel="icon" type="/image/vnd.microsoft.icon" href="./favicon.ico" /><link rel="stylesheet" href="./css/tutorial.css" type="text/css" /><script async="true" type="text/javascript" src="/js/site.js"></script><title> Authentication, Authorisation, Access Control
 â€” RabbitMQ</title></head>
  <body id="access-control"><div id="outerContainer"><div class="container"><div class="rabbit-logo"><a href="./"><img src="./img/logo-rabbitmq.svg" alt="RabbitMQ" /></a></div><a class="btn menubtn" onclick="showHide()">Menu <img src="./img/carrot-down-white.svg" /></a><div class="mobilemenuicon" onclick="showHide()"><img src="./img/mobile-menu-icon.svg" /></div><div id="nav"><ul id="mainNav"><li><a href="./#features">Features</a></li><li><a href="./#getstarted">Get Started</a></li><li><a href="./#support">Support</a></li><li><a href="./#community">Community</a></li><li><a href="./documentation.html">Docs</a></li></ul></div></div><div class="nav-separator"></div><div id="innerContainer" class="container"><div id="left-content"><h1> Authentication, Authorisation, Access Control
</h1>


<h2><a id="overview" class="anchor" href="#overview">Overview</a></h2>
<p>This document describes <a href="#authentication">authentication</a> and <a href="#authorisation">authorisation</a> features
in RabbitMQ. Together they allow the operator to control access to the system.</p>
<p>Different users can be granted access only to specific <a href="./vhosts.html">virtual hosts</a>. Their
permissions in each virtual hosts also can be limited.</p>
<p>RabbitMQ supports two major <a href="#mechanisms">authentication mechanisms</a>
as well as several <a href="#backends">authentication and authorisation backends</a>.</p>
<p>This guide covers a variety of authentication, authorisation and user management topics such as</p>
<ul>
<li><a href="#basics">Access control essentials</a></li>
<li><a href="#default-state">Default virtual host and user</a></li>
<li><a href="#loopback-users">Connectivity limitations</a> imposed on the default user</li>
<li>How to <a href="#user-management">manage users and permissions</a> using CLI tools</li>
<li>How to change an authentication or authorization <a href="#backends">backend used</a>, or use a combination of backends</li>
<li>How to <a href="#certificate-authentication">authenticate clients using their TLS certificate information</a></li>
<li>How to limit <a href="#topic-authorisation">access to topics on a topic exchange</a></li>
<li><a href="#user-tags">User tags</a> and how they are used</li>
<li>How to <a href="#revoke">revoke access</a> for a user</li>
<li><a href="#passwords-and-shell-escaping">Shell escaping</a> of characters in generated passwords</li>
<li>How to <a href="#seeding">pre-create users</a> and their permissions</li>
<li>Troubleshooting of <a href="#troubleshooting-authn">authentication</a> and <a href="#troubleshooting-authz">authorisation failures</a></li>
</ul>
<p><a href="./passwords.html">Password-based</a> authentication has a companion guide.
A closely related topic of <a href="./ssl.html">TLS support</a> is also covered in a dedicated guide.</p>
<h2><a id="terminology-and-definitions" class="anchor" href="#terminology-and-definitions">Terminology and Definitions</a></h2>
<p>Authentication and authorisation are often confused or used
interchangeably. That's wrong and in RabbitMQ, the two are
separated. For the sake of simplicity, we'll define
authentication as "identifying who the user is" and
authorisation as "determining what the user is and isn't allowed to do."</p>
<h2><a id="basics" class="anchor" href="#basics">The Basics</a></h2>
<p>Clients use RabbitMQ features to <a href="connections.html">connect</a> to it. Every connection has
an associated user which is authenticated. It also targets a <a href="./vhosts.html">virtual host</a> for which
the user must have a certain set of permissions.</p>
<p>User credentials, target virtual host and (optionally) client <a href="./ssl.html">certificate</a> are specified at connection
initiation time.</p>
<p>There is a default pair of credentials called the <a href="#default-state">default user</a>. This user can only
be <a href="#loopback-users">used for <strong>host-local connections</strong></a> by default. Remote connections that use
it will be refused.</p>
<p><a href="./production-checklist.html">Production environments</a> should not use the default user and create
new user accounts with generated credentials instead.</p>
<h2><a id="default-state" class="anchor" href="#default-state">Default Virtual Host and User</a></h2>
<p>When the server first starts running, and detects that its
database is uninitialised or has been deleted, it
initialises a fresh database with the following resources:</p>
<ul>
<li>a <a href="./vhosts.html">virtual host</a> named <span class="code ">/</span> (a slash)</li>
<li>a user named <span class="code ">guest</span> with a default password of <span class="code ">guest</span>, granted full access to the <span class="code ">/</span> virtual host</li>
</ul>
<p>It is advisable to <a href="#seeding">pre-configure a new user with a generated username and password</a> or <a href="rabbitmqctl.8.html#delete_user">delete</a>
the <span class="code ">guest</span> user or at least <a href="rabbitmqctl.8.html#change_password">change its password</a>
to reasonably secure generated value that won't be known to the public.</p>
<h2><a id="authentication" class="anchor" href="#authentication">Authentication: Who Do You Say You Are?</a></h2>
<p>After an application connects to RabbitMQ and before it can perform operations, it must
authenticate, that is, present and prove its identity. With that identity, RabbitMQ nodes can
look up its permissions and <a href="#authorisation">authorize</a> access to resources
such as <a href="./vhosts.html">virtual hosts</a>, queues, exchanges, and so on.</p>
<p>Two primary ways of authenticating a client are <a href="./passwords.html">username/password pairs</a>
and <a href="https://en.wikipedia.org/wiki/X.509">X.509 certificates</a>. Username/password pairs
can be used with a variety of <a href="#backends">authentication backends</a> that verify the credentials.</p>
<p>Connections that fail to authenticate will be closed with an error message in the <a href="./logging.html">server log</a>.</p>
<h3><a id="certificate-authentication" class="anchor" href="#certificate-authentication">Authentication using Client TLS (x.509) Certificate Data</a></h3>
<p>To authenticate client connections using X.509 certificate a built-in plugin,
<a href="https://github.com/rabbitmq/rabbitmq-auth-mechanism-ssl">rabbitmq-auth-mechanism-ssl</a>,
must be enabled and clients must be <a href="#mechanisms">configured to use the EXTERNAL mechanism</a>.
With this mechanism, any client-provided password will be ignored.</p>
<h2><a id="loopback-users" class="anchor" href="#loopback-users">"guest" user can only connect from localhost</a></h2>
<p>By default, the <span class="code ">guest</span> user is prohibited from
connecting from remote hosts; it can only connect over
a loopback interface (i.e. <span class="code ">localhost</span>). This
applies to <a href="connections.html">connections regardless of the protocol</a>.
Any other users will not (by default) be restricted in this way.</p>
<p>The recommended way to address this in production systems
is to create a new user or set of users with the permissions
to access the necessary virtual hosts. This can be done
using <a href="./cli.html">CLI tools</a>, <a href="./management.html">HTTP API or definitions import</a>.</p>
<p>This is configured via the <span class="code ">loopback_users</span> item
in the <a href="configure.html#configuration-files">configuration file</a>.</p>
<p>It is possible to allow the <span class="code ">guest</span> user to connect
from a remote host by setting the
<span class="code ">loopback_users</span> configuration to
<span class="code ">none</span>.</p>
<p>A minimalistic <a href="configure.html">RabbitMQ config file</a>
which allows remote connections for <span class="code ">guest</span> looks like so:</p>
<pre class="lang-ini">
# DANGER ZONE!
#
# allowing remote connections for default user is highly discouraged
# as it dramatically decreases the security of the system. Delete the user
# instead and create a new one with generated secure credentials.
loopback_users = none
</pre>

<h2><a id="user-management" class="anchor" href="#user-management">Managing Users and Permissions</a></h2>
<p>Users and permissions can be managed using <a href="./cli.html">CLI tools</a> and definition import (covered below).</p>
<h3><a id="passwords-and-shell-escaping" class="anchor" href="#passwords-and-shell-escaping">Before We Start: Shell Escaping and Generated Passwords</a></h3>
<p>It is a common security practice to generate complex passwords,
often involving non-alphanumeric characters. This practice is perfectly
applicable to RabbitMQ users.</p>
<p>Shells (<span class="code ">bash</span>, <span class="code ">zsh</span>, and so on) interpret certain characters
(<span class="code ">!</span>, <span class="code ">?</span>, <span class="code ">&amp;</span>, <span class="code ">^</span>, <span class="code ">"</span>, <span class="code ">'</span>, <span class="code ">*</span>, <span class="code ">~</span>, and others) as control characters.</p>
<p>When a password is specified on the command line for <span class="code ">rabbitmqctl add_user</span>, <span class="code ">rabbitmqctl change_password</span>,
and other commands that accept a password, such control characters must be escaped appropriately
for the shell used.
With inappropriate escaping the command will fail or RabbitMQ CLI tools will receive a different value
from the shell.</p>
<p>When generating passwords that will be passed on the command line,
long (say, 40 to 100 characters) alphanumeric value with a very limited set of
symbols (e.g. <span class="code ">:</span>, <span class="code ">=</span>) is the safest option.</p>
<p>When users are created via <a href="./management.html">HTTP API</a> without using a shell (e.g. <span class="code ">curl</span>),
the control character limitation does not apply. However, different escaping rules may be necessary
depending on the programming language used.</p>
<h3>Adding a User</h3>
<p>To add a user, use <span class="code ">rabbitmqctl add_user</span>. It has multiple ways of specifying a <a href="./passwords.html">password</a>:</p>
<pre class="lang-bash">
# will prompt for password, only use this option interactively
rabbitmqctl add_user "username"
</pre>

<pre class="lang-bash">
# Password is provided via standard input.
# Note that certain characters such as $, &amp;, &amp;, #, and so on must be escaped to avoid
# special interpretation by the shell.
echo '2a55f70a841f18b97c3a7db939b7adc9e34a0f1b' | rabbitmqctl add_user 'username'
</pre>

<pre class="lang-bash">
# Password is provided as a command line argument.
# Note that certain characters such as $, &amp;, &amp;, #, and so on must be escaped to avoid
# special interpretation by the shell.
rabbitmqctl add_user 'username' '2a55f70a841f18b97c3a7db939b7adc9e34a0f1b'
</pre>

<p>On Windows, <span class="code ">rabbitmqctl</span> becomes <span class="code ">rabbitmqctl.bat</span> and shell escaping would be different:</p>
<pre class="lang-powershell">
# password is provided as a command line argument
rabbitmqctl.bat add_user 'username' '9a55f70a841f18b97c3a7db939b7adc9e34a0f1d'
</pre>

<h3>Listing Users</h3>
<p>To list users in a cluster, use <span class="code ">rabbitmqctl list_users</span>:</p>
<pre class="lang-bash">
rabbitmqctl list_users
</pre>

<pre class="lang-powershell">
rabbitmqctl.bat list_users
</pre>

<p>The output can be changed to be JSON:</p>
<pre class="lang-bash">
rabbitmqctl list_users --formatter=json
</pre>

<pre class="lang-powershell">
rabbitmqctl.bat list_users --formatter=json
</pre>

<h3>Deleting a User</h3>
<p>To delete a user, use <span class="code ">rabbitmqctl delete_user</span>:</p>
<pre class="lang-bash">
rabbitmqctl delete_user 'username'
</pre>

<pre class="lang-powershell">
rabbitmqctl.bat delete_user 'username'
</pre>

<h3>Granting Permissions to a User</h3>
<p>To grant <a href="#authorisation">permissions</a> to a user in a <a href="./vhosts.html">virtual host</a>, use <span class="code ">rabbitmqctl set_permissions</span>:</p>
<pre class="lang-bash">
# First ".*" for configure permission on every entity
# Second ".*" for write permission on every entity
# Third ".*" for read permission on every entity
rabbitmqctl set_permissions -p "custom-vhost" "username" ".*" ".*" ".*"
</pre>

<pre class="lang-powershell">
# First ".*" for configure permission on every entity
# Second ".*" for write permission on every entity
# Third ".*" for read permission on every entity
rabbitmqctl.bat set_permissions -p 'custom-vhost' 'username' '.*' '.*' '.*'
</pre>

<h3>Clearing Permissions of a User in a Virtual Host</h3>
<p>To revoke <a href="#authorisation">permissions</a> from a user in a <a href="./vhosts.html">virtual host</a>, use <span class="code ">rabbitmqctl clear_permissions</span>:</p>
<pre class="lang-bash">
# Revokes permissions in a virtual host
rabbitmqctl clear_permissions -p "custom-vhost" "username"
</pre>

<pre class="lang-powershell">
# Revokes permissions in a virtual host
rabbitmqctl.bat clear_permissions -p 'custom-vhost' 'username'
</pre>

<h3>Operations on Multiple Virtual Hosts</h3>
<p>Every <span class="code ">rabbitmqctl</span> permission management operation is scoped to a single virtual host.
Bulk operations have to be scripted, with the list of virtual hosts coming from <span class="code ">rabbitmqctl list_vhosts --silent</span>:</p>
<pre class="lang-bash">
# Assumes a Linux shell.
# Grants a user permissions to all virtual hosts.
for v in $(rabbitmqctl list_vhosts --silent); do rabbitmqctl set_permissions -p $v "a-user" ".*" ".*" ".*"; done
</pre>

<h2><a id="seeding" class="anchor" href="#seeding">Seeding (Pre-creating) Users and Permissions</a></h2>
<p><a href="./production-checklist.html">Production environments</a> typically need to pre-configure (seed) a number
of virtual hosts, users and user permissions.</p>
<p>This can be done in a few ways:</p>
<ul>
<li>Using <a href="./cli.html">CLI tools</a></li>
<li><a href="./definitions.html">Definition export and import on node boot</a> (recommended)</li>
<li>Override <a href="#default-state">default credentials</a> in configuration file(s)</li>
</ul>
<h3>CLI Tools</h3>
<p>See the section on <a href="#user-management">User Management</a>.</p>
<h3>Definition Import at Node Boot Time</h3>
<p>This process involves the following steps:</p>
<ul>
<li>Set up a temporary node and create the necessary virtual host, users, permissions, and so on using CLI tools</li>
<li>Export definitions to a definition file</li>
<li>Remove parts of the file that are not relevant</li>
<li>Configure the node to import the file on node boot or after</li>
</ul>
<p>See <a href="./definitions.html#import-on-boot">importing definitions on node boot</a> in the definitions guide to learn more.</p>
<h3>Definition Import After Node Boot</h3>
<p>See <a href="./definitions.html#import">importing definitions after node boot</a> in the definitions guide.</p>
<h3>Override Default User Credentials</h3>
<p>Two configuration options can be used to override default user credentials. This user will only
be created <strong>on first node boot</strong> so they must exist in the configuration file before
first boot.</p>
<p>The settings are:</p>
<pre class="lang-ini">
# default is "guest", and its access is limited to localhost only.
# See https://www.rabbitmq.com/access-control.html#default-state
default_user = a-user
# default is "guest"
default_pass = 768a852ed69ce916fa7faa278c962de3e4275e5f
</pre>

<p>As with all values in <a href="./configure.html#config-file"><span class="code ">rabbitmq.conf</span></a>, the <span class="code ">#</span> character
starts a comment so this character must be avoided in generated credentials.</p>
<p>Default user credentials can also be encrypted.
That requires the use of the <a href="./configure.html#advanced-config-file">advanced configuration file</a>, <span class="code ">advanced.config</span>.
This topic is covered in more detail in <a href="./configure.html#configuration-encryption">Configuration Value Encryption</a>.</p>
<h2><a id="authorisation" class="anchor" href="#authorisation">Authorisation: How Permissions Work</a></h2>
<p>When a RabbitMQ client establishes a connection to a
server and <a href="#authentication">authenticates</a>, it specifies a virtual host within which it intends
to operate. A first level of access control is enforced at
this point, with the server checking whether the user has
any permissions to access the virtual hosts, and rejecting
the connection attempt otherwise.</p>
<p>Resources, i.e. exchanges and queues, are named entities
inside a particular virtual host; the same name denotes a
different resource in each virtual host. A second level of
access control is enforced when certain operations are
performed on resources.</p>
<p>RabbitMQ distinguishes between <em>configure</em>,
<em>write</em> and <em>read</em> operations on a
resource. The <em>configure</em> operations create or
destroy resources, or alter their behaviour. The
<em>write</em> operations inject messages into a
resource. And the <em>read</em> operations retrieve messages
from a resource.</p>
<p>In order to perform an operation on a resource the user must
have been granted the appropriate permissions for it. The
following table shows what permissions on what type of
resource are required for all the AMQP commands which
perform permission checks.</p>
<table>
  <tr>
    <th>AMQP 0-9-1 Operation</th>
    <th></th>
    <th>configure</th>
    <th>write</th>
    <th>read</th>
  </tr>
  <tr>
    <td>exchange.declare</td><td>(passive=false)</td><td>exchange</td><td></td><td></td>
  </tr>
  <tr>
    <td>exchange.declare</td><td>(passive=true)</td><td></td><td></td><td></td>
  </tr>
  <tr>
    <td>exchange.declare</td><td>(with <a href="ae.html">AE</a>)</td><td>exchange</td><td>exchange (AE)</td><td>exchange</td>
  </tr>
  <tr>
    <td>exchange.delete</td><td></td><td>exchange</td><td></td><td></td>
  </tr>
  <tr>
    <td>queue.declare</td><td>(passive=false)</td><td>queue</td><td></td><td></td>
  </tr>
  <tr>
    <td>queue.declare</td><td>(passive=true)</td><td></td><td></td><td></td>
  </tr>
  <tr>
    <td>queue.declare</td><td>(with <a href="dlx.html">DLX</a>)</td><td>queue</td><td>exchange (DLX)</td><td>queue</td>
  </tr>
  <tr>
    <td>queue.delete</td><td></td><td>queue</td><td></td><td></td>
  </tr>
  <tr>
    <td>exchange.bind</td><td></td><td></td><td>exchange (destination)</td><td>exchange (source)</td>
  </tr>
  <tr>
    <td>exchange.unbind</td><td></td><td></td><td>exchange (destination)</td><td>exchange (source)</td>
  </tr>
  <tr>
    <td>queue.bind</td><td></td><td></td><td>queue</td><td>exchange</td>
  </tr>
  <tr>
    <td>queue.unbind</td><td></td><td></td><td>queue</td><td>exchange</td>
  </tr>
  <tr>
    <td>basic.publish</td><td></td><td></td><td>exchange</td><td></td>
  </tr>
  <tr>
    <td>basic.get</td><td></td><td></td><td></td><td>queue</td>
  </tr>
  <tr>
    <td>basic.consume</td><td></td><td></td><td></td><td>queue</td>
  </tr>
  <tr>
    <td>queue.purge</td><td></td><td></td><td></td><td>queue</td>
  </tr>
</table>

<p>Permissions are expressed as a triple of regular expressions
â€” one each for configure, write and read â€” on per-vhost
basis. The user is granted the respective permission for
operations on all resources with names matching the regular
expressions.</p>
<p>For convenience RabbitMQ maps AMQP 0-9-1's
default exchange's blank name to 'amq.default' when
performing permission checks.</p>
<p>The regular expression <span class="code ">'^$'</span>, i.e. matching
nothing but the empty string, covers all resources and
effectively stops the user from performing any operation.
Built-in AMQP 0-9-1 resource names are prefixed with
<span class="code ">amq.</span> and server generated names are prefixed
with <span class="code ">amq.gen</span>.</p>
<p>For example, <span class="code ">'^(amq\.gen.*|amq\.default)$'</span> gives a user access to
server-generated names and the default exchange.  The empty
string, <span class="code ">''</span> is a synonym for <span class="code ">'^$'</span>
and restricts permissions in the exact same way.</p>
<p>RabbitMQ may cache the results of access control checks on a
per-connection or per-channel basis. Hence changes to user
permissions may only take effect when the user reconnects.</p>
<p>For details of how to set up access control, please see the
<a href="#user-management">User management</a> section
as well as the <a href="rabbitmqctl.8.html">rabbitmqctl man page</a>.</p>
<h3><a id="user-tags" class="anchor" href="#user-tags">User Tags and Management UI Access</a></h3>
<p>In addition to the permissions covered above, users can have tags
associated with them. Currently only management UI access is  controlled by user tags.</p>
<p>The tags are managed using <a href="./rabbitmqctl.8.html#set_user_tags">rabbitmqctl</a>.
Newly created users do not have any tags set on them by default.</p>
<p>Please refer to the <a href="./management.html#permissions">management plugin guide</a> to learn
more about what tags are supported and how they limit management UI access.</p>
<h2><a id="topic-authorisation" class="anchor" href="#topic-authorisation">Topic Authorisation</a></h2>
<p>RabbitMQ supports topic authorisation for topic exchanges. The routing key of a message
published to a topic exchange is taken into account when
publishing authorisation is enforced (e.g. in RabbitMQ default authorisation backend,
the routing key is matched against a regular expression to decide whether the message can be
routed downstream or not).
Topic authorisation targets protocols like STOMP and MQTT, which are structured
around topics and use topic exchanges under the hood.</p>
<p>Topic authorisation is an additional layer on top of
existing checks for publishers. Publishing a
message to a topic-typed exchange will go through both the
<span class="code ">basic.publish</span> and the routing key checks.
The latter is never called if the former refuses access.</p>
<p>Topic authorisation can also be enforced for topic consumers.
Note that it works differently for different protocols. The concept
of topic authorisation only really makes sense for the topic-oriented protocols such as MQTT
and STOMP. In AMQP 0-9-1, for example, consumers consume from queues
and thus the standard resource permissions apply. In addition for AMQP 0-9-1,
binding routing keys between an AMQP 0-9-1 topic exchange and
a queue/exchange are checked against the topic permissions configured, if any.
For more information about how RabbitMQ handles authorisation for topics, please see
the <a href="stomp.html">STOMP</a> and <a href="mqtt.html">MQTT</a>
documentation guides.</p>
<p>When default authorisation backend is used, publishing to a
topic exchange or consuming from a topic is always authorised
if no topic permissions
are defined (which is the case on a fresh RabbitMQ
installation). With this authorisation backend, topic
authorisation is optional: you don't need to whitelist any
exchanges. To use topic authorisation therefore you need to opt in
and define topic permissions for one or more exchanges. For details please see
the <a href="man/rabbitmqctl.8.html">rabbitmqctl man page</a>.</p>
<p>Internal (default) authorisation backend supports variable expansion
in permission patterns.
Three variables are supported: <span class="code ">username</span>, <span class="code ">vhost</span>,
and <span class="code ">client_id</span>. Note that <span class="code ">client_id</span> only
applies to MQTT. For example, if <span class="code ">tonyg</span> is the
connected user, the permission <span class="code ">^{username}-.*</span> is expanded to
<span class="code ">^tonyg-.*</span></p>
<p>If a different authorisation backend (e.g. <a href="ldap.html">LDAP</a>,
<a href="https://github.com/rabbitmq/rabbitmq-auth-backend-http">HTTP</a>,
<a href="https://github.com/rabbitmq/rabbitmq-auth-backend-amqp">AMQP</a>) is used, please refer
to the documentation of those backends.</p>
<p>If a custom authorisation backend is used, topic
authorisation is enforced by implementing the
<span class="code ">check_topic_access</span> callback of the
<span class="code ">rabbit_authz_backend</span> behavior.</p>
<h2><a id="revoke" class="anchor" href="#revoke">Revoking User Access</a></h2>
<p>To revoke user access, the recommended procedure is <a href="#user-management">deleting the user</a>.
All open connections that belong to a deleted user will be closed.</p>
<p>It is also possible to clear user permissions but that will not affect
any currently open connections. Connections
use an authorization operation cache, so client operations
will be refused eventually. The period of time depends on the
<a href="#backends">authorization backend</a> used.</p>
<h2><a id="backends" class="anchor" href="#backends">Alternative Authentication and Authorisation Backends</a></h2>
<p>Authentication and authorisation are pluggable. Plugins can provide implementations
of</p>
<ul>
<li>authentication ("authn") backends</li>
<li>authorisation ("authz") backends</li>
</ul>
<p>It is possible for a plugin to provide both.
For example the internal, <a href="ldap.html">LDAP</a>
and <a href="https://github.com/rabbitmq/rabbitmq-auth-backend-http">HTTP</a>
backends do so.</p>
<p>Some plugins, for example, the <a href="https://github.com/gotthardp/rabbitmq-auth-backend-ip-range">Source IP range one</a>,
only provide an authorisation backend. Authentication is supposed to be handled by the internal database, LDAP, etc.</p>
<p>A special <a href="https://github.com/rabbitmq/rabbitmq-server/tree/v3.9.x/deps/rabbitmq_auth_backend_cache">cache backend</a>
can be used in <a href="#combined-backends">combination</a> with other backends to significantly
reduce the load they generate on external services, such as LDAP or HTTP servers.</p>
<h3><a id="combined-backends" class="anchor" href="#combined-backends">Combining Backends</a></h3>
<p>It is possible to use multiple backends for
<span class="code ">authn</span> or <span class="code ">authz</span> using the
<span class="code ">auth_backends</span> configuration key. When
several authentication backends are used then the first
positive result returned by a backend in the chain is
considered to be final. This should not be confused with
mixed backends (for example, using LDAP for authentication and internal
backend for authorisation).</p>
<p>The following example configures RabbitMQ to use the internal backend
only (and is the default):</p>
<pre class="lang-ini">
# rabbitmq.conf
#
# 1 here is a backend name. It can be anything.
# Since we only really care about backend
# ordering, we use numbers throughout this guide.
#
# "internal" is an alias for rabbit_auth_backend_internal
auth_backends.1 = internal
</pre>

<p>The example above uses an alias, <span class="code ">internal</span> for <span class="code ">rabbit_auth_backend_internal</span>.
The following aliases are available:</p>
<ul>
<li><span class="code ">internal</span> for <span class="code ">rabbit_auth_backend_internal</span></li>
<li><span class="code ">ldap</span> for <span class="code ">rabbit_auth_backend_ldap</span> (from the <a href="./ldap.html">LDAP plugin</a>)</li>
<li><span class="code ">http</span> for <span class="code ">rabbit_auth_backend_http</span> (from the <a href="https://github.com/rabbitmq/rabbitmq-auth-backend-http">HTTP auth backend plugin</a>)</li>
<li><span class="code ">amqp</span> for <span class="code ">rabbit_auth_backend_amqp</span> (from the <a href="https://github.com/rabbitmq/rabbitmq-auth-backend-amqp">AMQP 0-9-1 auth backend plugin</a>)</li>
<li><span class="code ">dummy</span> for <span class="code ">rabbit_auth_backend_dummy</span></li>
</ul>
<p>When using third party plugins, providing a full module name is necessary.</p>
<p>The following example configures RabbitMQ to use the <a href="./ldap.html">LDAP backend</a>
for both authentication and authorisation. Internal database will not be consulted:</p>
<pre class="lang-ini">
auth_backends.1 = ldap
</pre>

<p>This will check LDAP first, and then fall back to the internal
database if the user cannot be authenticated through LDAP:</p>
<pre class="lang-ini">
auth_backends.1 = ldap
auth_backends.2 = internal
</pre>

<p>Same as above but will fall back to the <a href="https://github.com/rabbitmq/rabbitmq-auth-backend-http">HTTP backend</a>
instead:</p>
<pre class="lang-ini">
# rabbitmq.conf
#
auth_backends.1 = ldap
# uses module name instead of a short alias, "http"
auth_backends.2 = rabbit_auth_backend_http

# See HTTP backend docs for details
auth_http.user_path = http://my-authenticator-app/auth/user
auth_http.vhost_path = http://my-authenticator-app/auth/vhost
auth_http.resource_path = http://my-authenticator-app/auth/resource
auth_http.topic_path = http://my-authenticator-app/auth/topic
</pre>

<p>The following example configures RabbitMQ to use the internal
database for authentication and the <a href="https://github.com/gotthardp/rabbitmq-auth-backend-ip-range">source IP range backend</a> for authorisation:</p>
<pre class="lang-ini">
# rabbitmq.conf
#
auth_backends.1.authn = internal
# uses module name because this backend is from a 3rd party
auth_backends.1.authz = rabbit_auth_backend_ip_range
</pre>

<p>The following example configures RabbitMQ to use the <a href="./ldap.html">LDAP backend</a>
for authentication and the internal backend for authorisation:</p>
<pre class="lang-ini">
# rabbitmq.conf
#
auth_backends.1.authn = ldap
auth_backends.1.authz = internal
</pre>

<p>The example below is fairly advanced. It will check LDAP
first. If the user is found in LDAP then the password will be
checked against LDAP and subsequent authorisation checks will
be performed against the internal database (therefore users in
LDAP must exist in the internal database as well, but do not
need a password there). If the user is not found in LDAP then
a second attempt is made using only the internal database:</p>
<pre class="lang-ini">
# rabbitmq.conf
#
auth_backends.1.authn = ldap
auth_backends.1.authz = internal
auth_backends.2       = internal
</pre>

<h2><a id="mechanisms" class="anchor" href="#mechanisms">Authentication Mechanisms</a></h2>
<p>RabbitMQ supports multiple SASL authentication
mechanisms. There are three such mechanisms built into the
server: <span class="code ">PLAIN</span>, <span class="code ">AMQPLAIN</span>,
and <span class="code ">RABBIT-CR-DEMO</span>, and one â€” <span class="code ">EXTERNAL</span> â€”
available as a <a href="https://github.com/rabbitmq/rabbitmq-auth-mechanism-ssl">plugin</a>.</p>
<p>More authentication mechanisms can be provided by plugins. See
the <a href="plugin-development.html">plugin development guide</a> for more information on general plugin
development.</p>
<h3><a id="available-mechanisms" class="anchor" href="#available-mechanisms">Built-in Authentication Mechanisms</a></h3>
<p>The built-in mechanisms are:</p>
<table>
  <thead>
    <td>Mechanism</td>
    <td>Description</td>
  </thead>

  <tr>
    <td>PLAIN</td>
    <td>
      SASL PLAIN authentication. This is enabled by default in
      the RabbitMQ server and clients, and is the default for most
      other clients.
    </td>
  </tr>

  <tr>
    <td>AMQPLAIN</td>
    <td>
      Non-standard version of PLAIN retained for backwards compatibility.
      This is enabled by default in the RabbitMQ server.
    </td>
  </tr>

  <tr>
    <td>EXTERNAL</td>
    <td>
      Authentication happens using an out-of-band mechanism
      such as <a href="https://github.com/rabbitmq/rabbitmq-auth-mechanism-ssl">x509 certificate peer verification</a>,
      client IP address range, or similar. Such mechanisms are usually provided by RabbitMQ plugins.
    </td>
  </tr>

  <tr>
    <td>RABBIT-CR-DEMO</td>
    <td>Non-standard mechanism which demonstrates
    challenge-response authentication. This mechanism has
    security equivalent to <span class="code ">PLAIN</span>, and
    is <strong>not</strong> enabled by default in the RabbitMQ server.</td>
  </tr>
</table>

<h3><a id="server-mechanism-configuration" class="anchor" href="#server-mechanism-configuration">Mechanism Configuration in the Server</a></h3>
<p>The configuration variable <span class="code ">auth_mechanisms</span> in
the <span class="code ">rabbit</span> application determines which of the
installed mechanisms are offered to connecting clients. This
variable should be a list of atoms corresponding to
mechanism names, for example
<span class="code ">['PLAIN', 'AMQPLAIN']</span> by default. The server-side list is not
considered to be in any particular order. See the
<a href="configure.html#configuration-files">configuration file</a>
documentation.</p>
<h3><a id="client-mechanism-configuration" class="anchor" href="#client-mechanism-configuration">Mechanism Configuration in the Client</a></h3>
<p>Applications must opt-in to use a different authentication mechanism
such as <span class="code ">EXTERNAL</span>.</p>
<h4><a id="client-mechanism-configuration-java" class="anchor" href="#client-mechanism-configuration-java">Mechanism Configuration in Java</a></h4>
<p>The Java client does not use
the <span class="code ">javax.security.sasl</span> package by default
since this can be unpredictable on non-Oracle JDKs and is
missing entirely on Android. There is a RabbitMQ-specific
SASL implementation, configured by
the <span class="code ">SaslConfig</span> interface. A
class <span class="code ">DefaultSaslConfig</span> is provided to make
SASL configuration more convenient in the common case. A
class <span class="code ">JDKSaslConfig</span> is provided to act as a
bridge to <span class="code ">javax.security.sasl</span>.</p>
<p><span class="code ">ConnectionFactory.getSaslConfig()</span>
and <span class="code ">ConnectionFactory.setSaslConfig(SaslConfig)</span>
are the primary methods for interacting with authentication mechanisms.</p>
<h4><a id="client-mechanism-configuration-dotnet" class="anchor" href="#client-mechanism-configuration-dotnet">Mechanism Configuration in .NET</a></h4>
<p>The .NET client provides its own SASL mechanism
implementations based on the <span class="code ">AuthMechanism</span>
and <span class="code ">AuthMechanismFactory</span>
interfaces. The <span class="code ">ConnectionFactory.AuthMechanisms</span>
property is a list of authentication mechanism factories in
preference order.</p>
<h4><a id="client-mechanism-configuration-erlang" class="anchor" href="#client-mechanism-configuration-erlang">Mechanism Configuration in Erlang</a></h4>
<p>The Erlang client provides its own SASL mechanism
implementations in the <span class="code ">amqp_auth_mechanisms</span>
module. The <span class="code ">#amqp_params{}</span> record can be
provided with a list of authentication functions in
preference order for network connections.</p>
<h2><a id="troubleshooting-authn" class="anchor" href="#troubleshooting-authn">Troubleshooting Authentication</a></h2>
<p><a href="./logging.html">Server logs</a> will contain entries about failed authentication
attempts:</p>
<pre class="lang-ini">
2019-03-25 12:28:19.047 [info] &lt;0.1613.0&gt; accepting AMQP connection &lt;0.1613.0&gt; (127.0.0.1:63839 -&gt; 127.0.0.1:5672)
2019-03-25 12:28:19.056 [error] &lt;0.1613.0&gt; Error on AMQP connection &lt;0.1613.0&gt; (127.0.0.1:63839 -&gt; 127.0.0.1:5672, state: starting):
PLAIN login refused: user 'user2' - invalid credentials
2019-03-25 12:28:22.057 [info] &lt;0.1613.0&gt; closing AMQP connection &lt;0.1613.0&gt; (127.0.0.1:63839 -&gt; 127.0.0.1:5672)
</pre>

<p>Authentication failures on connections that <a href="#authentication">authenticate using X.509 certificates</a>
will be logged differently. See <a href="./troubleshooting-ssl.html">TLS Troubleshooting guide</a> for details.</p>
<p><a href="./cli.html">rabbitmqctl authenticate_user</a> can be used to test authentication
for a username and password pair:</p>
<pre class="lang-bash">
rabbitmqctl authenticate_user "a-username" "a/password"
</pre>

<p>If authentication succeeds, it will exit with
the code of zero. In case of a failure, a non-zero exit code will be used and a failure error message will be printed.</p>
<p><span class="code ">rabbitmqctl authenticate_user</span> will use a CLI-to-node communication connection to attempt to authenticate
the username/password pair against an internal API endpoint.
The connection is assumed to be trusted. If that's not the case, its traffic can be <a href="./clustering-ssl.html">encrypted using TLS</a>.</p>
<p>Per AMQP 0-9-1 spec, authentication failures should result
in the server closing TCP connection immediately. However,
with RabbitMQ clients can opt in to receive a more specific
notification using the <a href="./auth-notification.html">authentication failure
notification</a> extension to AMQP 0-9-1. Modern client libraries
support that extension transparently to the user: no configuration would be necessary and
authentication failures will result in a visible returned error, exception or other way of communicating
a problem used in a particular programming language or environment.</p>
<h2><a id="troubleshooting-authz" class="anchor" href="#troubleshooting-authz">Troubleshooting Authorisation</a></h2>
<p><a href="./cli.html">rabbitmqctl list_permissions</a> can be used to inspect a user's
permission in a given virtual host:</p>
<pre class="lang-bash">
rabbitmqctl list_permissions --vhost /
# =&gt; Listing permissions for vhost "/" ...
# =&gt; user    configure   write   read
# =&gt; user2   .*  .*  .*
# =&gt; guest   .*  .*  .*
# =&gt; temp-user   .*  .*  .*

rabbitmqctl list_permissions --vhost gw1
# =&gt; Listing permissions for vhost "gw1" ...
# =&gt; user    configure   write   read
# =&gt; guest   .*  .*  .*
# =&gt; user2   ^user2  ^user2  ^user2
</pre>

<p><a href="./logging.html">Server logs</a> will contain entries about operation authorisation
failures. For example, if a user does not have any permissions configured for a virtual host:</p>
<pre class="lang-ini">
2019-03-25 12:26:16.301 [info] &lt;0.1594.0&gt; accepting AMQP connection &lt;0.1594.0&gt; (127.0.0.1:63793 -&gt; 127.0.0.1:5672)
2019-03-25 12:26:16.309 [error] &lt;0.1594.0&gt; Error on AMQP connection &lt;0.1594.0&gt; (127.0.0.1:63793 -&gt; 127.0.0.1:5672, user: 'user2', state: opening):
access to vhost '/' refused for user 'user2'
2019-03-25 12:26:16.310 [info] &lt;0.1594.0&gt; closing AMQP connection &lt;0.1594.0&gt; (127.0.0.1:63793 -&gt; 127.0.0.1:5672, vhost: 'none', user: 'user2')
</pre>

<p>authorisation failures (permission violations) are also logged:</p>
<pre class="lang-ini">
2019-03-25 12:30:05.209 [error] &lt;0.1627.0&gt; Channel error on connection &lt;0.1618.0&gt; (127.0.0.1:63881 -&gt; 127.0.0.1:5672, vhost: 'gw1', user: 'user2'), channel 1:
operation queue.declare caused a channel exception access_refused: access to queue 'user3.q1' in vhost 'gw1' refused for user 'user2'
</pre><div id="help-and-feedback"><h2>Getting Help and Providing Feedback</h2><p>
                    If you have questions about the contents of this guide or
                    any other topic related to RabbitMQ, don't hesitate to ask them
                    on the <a href="https://groups.google.com/forum/#!forum/rabbitmq-users">RabbitMQ mailing list</a>.
                  </p></div><div id="contribute"><h2>Help Us Improve the Docs &lt;3</h2><p>
                    If you'd like to contribute an improvement to the site,
                    its source is <a href="https://github.com/rabbitmq/rabbitmq-website">available on GitHub</a>.
                    Simply fork the repository and submit a pull request. Thank you!
                  </p></div></div><div id="right-nav"><div id="in-this-section"><h4>In This Section</h4><ul>
     <li><a href="/admin-guide.html" class="selected">Server Documentation</a><ul>
       <li><a href="/configure.html">Configuration</a></li>
       <li><a href="/management.html">Management UI</a></li>
       <li><a href="/monitoring.html">Monitoring</a></li>
       <li><a href="/production-checklist.html">Production Checklist</a></li>
       <li><a href="/ssl.html">TLS Support</a></li>
       <li><a href="/streams.html">Streams</a></li>
       <li><a href="/feature-flags.html">Feature Flags</a></li>
       <li><a href="/distributed.html">Distributed RabbitMQ</a></li>
       <li><a href="/clustering.html">Clustering</a></li>
       <li><a href="/reliability.html">Reliable Delivery</a></li>
       <li><a href="/definitions.html">Schema Definition Export and Import</a></li>
       <li><a href="/backup.html">Backup and restore</a></li>
       <li><a href="/alarms.html">Alarms</a></li>
       <li><a href="/memory-use.html">Memory Use</a></li>
       <li><a href="/networking.html">Networking</a></li>
       <li><a href="/vhosts.html">Virtual Hosts</a></li>
       <li><a href="/access-control.html" class="selected">Access Control (Authorisation)</a></li>
       <li><a href="/authentication.html">Authentication Mechanisms</a></li>
       <li><a href="/ldap.html">LDAP</a></li>
       <li><a href="/lazy-queues.html">Lazy Queues</a></li>
       <li><a href="/event-exchange.html">Internal Event Exchange</a></li>
       <li><a href="/firehose.html">Firehose (Message Tracing)</a></li>
       <li><a href="/manpages.html">Manual Pages</a></li>
       <li><a href="/windows-quirks.html">Windows Quirks</a></li>
       
       
       
       
     </ul></li>
     <li><a href="/clients.html">Client Documentation</a></li>
     <li><a href="/plugins.html">Plugins</a></li>
     <li><a href="/news.html">News</a></li>
     <li><a href="/protocol.html">Protocol</a></li>
     <li><a href="/extensions.html">Our Extensions</a></li>
     <li><a href="/build.html">Building</a></li>
     
     <li><a href="/mpl.html">License</a></li>
   </ul></div></div></div><div class="clear"></div><div class="pageFooter"><div class="container"></div><div class="container"><div class="rabbit-logo"><a href="./"><img src="./img/logo-rabbitmq-white.svg" alt="RabbitMQ" /></a></div><ul class="footerNav"><li><a href="./#features">Features</a></li><li><a href="./#getstarted">Get Started</a></li><li><a href="./#support">Support</a></li><li><a href="./#community">Community</a></li><li><a href="./documentation.html">Docs</a></li></ul><p id="copyright">
          Copyright Â© 2007-2022 <a href="https://tanzu.vmware.com/">VMware</a>, Inc. or its affiliates. All rights reserved.
          <a href="https://www.vmware.com/help/legal.html">Terms of Use</a> â€¢
          <a href="https://www.vmware.com/help/privacy.html">Privacy</a> â€¢
          <a href="./trademark-guidelines.html">Trademark Guidelines</a> â€¢
          <a href="https://www.vmware.com/help/privacy/california-privacy-rights.html">Your California Privacy Rights</a> â€¢
          <a class="ot-sdk-show-settings">Cookie Settings</a><br /><a id="teconsent"></a></p></div></div></div><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript">
        // code highlighting
        window.addEventListener("load", function() {
          const selectors = "pre.lang-bash, \
                             pre.lang-csharp, \
                             pre.lang-elixir, \
                             pre.lang-erlang, \
                             pre.lang-go, \
                             pre.lang-groovy, \
                             pre.lang-haskell, \
                             pre.lang-html, \
                             pre.lang-ini, \
                             pre.lang-java, \
                             pre.lang-javascript, \
                             pre.lang-json, \
                             pre.lang-makefile, \
                             pre.lang-objectivec, \
                             pre.lang-php, \
                             pre.lang-plaintext, \
                             pre.lang-powershell, \
                             pre.lang-python, \
                             pre.lang-ruby, \
                             pre.lang-swift, \
                             pre.lang-yaml, \
                             pre.lang-xml";
          document.querySelectorAll(selectors).forEach(function(el) {
            hljs.highlightBlock(el);
          });
        });
      </script></body>
</html>
