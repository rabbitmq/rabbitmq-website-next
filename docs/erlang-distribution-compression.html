<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-NSPM4RC');</script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="googlebot" content="NOODP" /><meta name="google-site-verification" content="nSYeDgyKM9mw5CWcZuD0xu7iSWXlJijAlg9rcxVOYf4" /><meta name="google-site-verification" content="6UEaC3SWhpGQvqRnSJIEm2swxXpM5Adn4dxZhFsNdw0" /><meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="viewport" name="viewport" /><link href="https://fonts.googleapis.com/css?family=Raleway:400,500,600,700" rel="stylesheet" /><link rel="stylesheet" href="/css/rabbit.css" type="text/css" /><link rel="stylesheet" href="/css/highlightjs_style.css" type="text/css" /><link rel="stylesheet" href="/css/rabbit-next.css" type="text/css" /><!--[if IE 6]>
      <link rel="stylesheet" href="/css/rabbit-ie6.css" type="text/css" />
      <![endif]--><link rel="icon" type="/image/vnd.microsoft.icon" href="/favicon.ico" /><link rel="stylesheet" href="/css/tutorial.css" type="text/css" /><script async="true" type="text/javascript" src="/js/site.js"></script><title>Erlang distribution compression — RabbitMQ</title>
    
  </head>
  <body id=""><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NSPM4RC" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="outerContainer"><div class="container"><div class="rabbit-logo"><a href="/"><img src="/img/logo-rabbitmq.svg" alt="RabbitMQ" /></a></div><a class="btn menubtn" onclick="showHide()">Menu <img src="/img/carrot-down-white.svg" /></a><div class="mobilemenuicon" onclick="showHide()"><img src="/img/mobile-menu-icon.svg" /></div><div id="nav"><ul id="mainNav"><li><a href="/#features">Features</a></li><li><a href="/#getstarted">Get Started</a></li><li><a href="/#support">Support</a></li><li><a href="/#community">Community</a></li><li><a href="/documentation.html">Docs</a></li></ul></div></div><div class="nav-separator"></div><div id="innerContainer" class="container"><div id="left-content"><h1>Erlang distribution compression</h1>
<p><a href="/tanzu/">VMware Tanzu RabbitMQ</a> introduced a feature called <em>Erlang
distribution compression</em>.</p>
<p>Erlang distribution allows several RabbitMQ nodes to communicate and create a
cluster. This is built into Erlang, the language and runtime used by RabbitMQ.
This is based on TCP/IP connections and the exchanged data can be plain or
ciphered if <a href="clustering-ssl.html">SSL is configured</a>.</p>
<p>As the name suggests, Erlang distribution compression adds a third transport
solution: compression. It allows inter-node communication to be reduced by up to
96%, depending on the nature of the data being compressed.</p>
<p class="box-info">
Erlang distribution compression is <strong>available in VMware Tanzu RabbitMQ
only</strong>, not in the standard FOSS RabbitMQ.
<a href="/tanzu/">Learn more about VMware Tanzu RabbitMQ</a>
</p>

<h2><a id="how-to-use-it" class="anchor" href="#how-to-use-it">How to use it</a></h2>
<p>Erlang distribution compression is enabled out-of-the-box: if two RabbitMQ
nodes connect to each other, they will try to use compression.</p>
<p>For the data to be compressed, the following conditions MUST be met:</p>
<ul>
<li>
<p>Both RabbitMQ nodes must support Erlang distribution compression. In other
  words, both nodes must run VMware Tanzu RabbitMQ. The FOSS edition does not
  support this feature.</p>
</li>
<li>
<p>Both RabbitMQ nodes must have at least one compression algorithm in common.</p>
</li>
</ul>
<p>If the conditions are not met, standard non-compressed Erlang distribution is
used. This means that RabbitMQ for VMware Tanzu remains compatible with the
standard RabbitMQ edition. It is therefore possible to switch from one edition
to the other without stopping the entire cluster.</p>
<h2><a id="how-it-works" class="anchor" href="#how-it-works">How it works</a></h2>
<div style="float: right;">
<img src="/img/erlang-distribution-compression/negotiation.svg" style="width: 100%; max-width: 500px; margin: 10px;" />
</div>

<p>The first time a RabbitMQ node tries to contact another node, it will do the
following things:</p>
<ol>
<li>
<p>After the TCP connection is open, it is as if the regular Erlang
   distribution uncompressed was used.</p>
</li>
<li>
<p>The node initiating the connection <strong>detects if the remote node has Erlang
   distribution compression support</strong>. If it does not, then the connection
   remains uncompressed and following steps are skipped.</p>
</li>
<li>
<p>Once the node is sure the remote node supports compression, it <strong>negotiates
   the algorithm to use</strong>. To start this process, it sends a message to the
   remote node and specifies the list of algorithms it supports.</p>
</li>
<li>
<p>The remote node compares the received list of algorithms to its own list.
   The remote node's list is ordered by preference. The selected algorithm is
   the first one in the remote node's list which is also supported by the
   initiating node. If there is no algorithm in common, the connection remains
   uncompressed and following steps are skipped.</p>
</li>
<li>
<p>Once an algorithm is selected, the remote node <strong>sends a message back to the
   initiating node to inform it of its decision</strong>.</p>
</li>
<li>
<p>The two nodes synchronize to <strong>start compression</strong> on the existing TCP
   connection.</p>
</li>
</ol>
<h2><a id="limitations" class="anchor" href="#limitations">Limitations</a></h2>
<ul>
<li>
<p>Erlang distribution <strong>compression and SSL can't be used at the same time</strong>:
    the user must choose between them.</p>
<p>The reason is that the Erlang node is configured with a specific
distribution module provided with VMware Tanzu RabbitMQ, plus a small
Erlang application to deal with the algorithm negotiation. The distribution
module is a replacement to the default module (<span class="code ">inet_tcp_dist</span>) or the
SSL-based one (<span class="code ">inet_tls_dist</span>). It is impossible to use two modules
simultaneously.</p>
</li>
<li>
<p>In VMware Tanzu RabbitMQ, the compression code relies on native libraries.
    <strong>Only Linux/amd64 is supported</strong> in the existing packaging. We might
    compile for more platforms in the future.</p>
</li>
</ul><div id="help-and-feedback"><h2>Getting Help and Providing Feedback</h2><p>
                    If you have questions about the contents of this guide or
                    any other topic related to RabbitMQ, don't hesitate to ask them
                    on the <a href="https://groups.google.com/forum/#!forum/rabbitmq-users">RabbitMQ mailing list</a>.
                  </p></div><div id="contribute"><h2>Help Us Improve the Docs &lt;3</h2><p>
                    If you'd like to contribute an improvement to the site,
                    its source is <a href="https://github.com/rabbitmq/rabbitmq-website">available on GitHub</a>.
                    Simply fork the repository and submit a pull request. Thank you!
                  </p></div></div><div id="right-nav"><div id="in-this-section"><h4>In This Section</h4><ul>
     <li><a href="/admin-guide.html" class="selected">Server Documentation</a><ul>
       <li><a href="/configure.html">Configuration</a></li>
       <li><a href="/management.html">Management UI</a></li>
       <li><a href="/monitoring.html">Monitoring</a></li>
       <li><a href="/production-checklist.html">Production Checklist</a></li>
       <li><a href="/ssl.html">TLS Support</a></li>
       <li><a href="/streams.html">Streams</a></li>
       <li><a href="/feature-flags.html">Feature Flags</a></li>
       <li><a href="/distributed.html">Distributed RabbitMQ</a></li>
       <li><a href="/clustering.html" class="selected">Clustering</a><ul>
         <li><a href="/cluster-formation.html">Cluster Formation</a></li>
         <li><a href="/ha.html">High Availability</a></li>
         <li><a href="/partitions.html">Network Partitions</a></li>
         <li><a href="/nettick.html">Net Tick Time</a></li>
         <li><a href="/clustering-ssl.html">TLS for Inter-node (Clustering) Traffic</a></li>
         <li><a href="/erlang-distribution-compression.html" class="selected">Inter-node Traffic Compression</a></li>
       </ul></li>
       <li><a href="/reliability.html">Reliable Delivery</a></li>
       <li><a href="/definitions.html">Schema Definition Export and Import</a></li>
       <li><a href="/backup.html">Backup and restore</a></li>
       <li><a href="/alarms.html">Alarms</a></li>
       <li><a href="/memory-use.html">Memory Use</a></li>
       <li><a href="/networking.html">Networking</a></li>
       <li><a href="/vhosts.html">Virtual Hosts</a></li>
       <li><a href="/pacemaker.html">High Availability (pacemaker)</a></li>
       <li><a href="/access-control.html">Access Control (Authorisation)</a></li>
       <li><a href="/authentication.html">Authentication Mechanisms</a></li>
       <li><a href="/ldap.html">LDAP</a></li>
       <li><a href="/lazy-queues.html">Lazy Queues</a></li>
       <li><a href="/event-exchange.html">Internal Event Exchange</a></li>
       <li><a href="/firehose.html">Firehose (Message Tracing)</a></li>
       <li><a href="/manpages.html">Manual Pages</a></li>
       <li><a href="/windows-quirks.html">Windows Quirks</a></li>
       
       
       
       
     </ul></li>
     <li><a href="/clients.html">Client Documentation</a></li>
     <li><a href="/plugins.html">Plugins</a></li>
     <li><a href="/news.html">News</a></li>
     <li><a href="/protocol.html">Protocol</a></li>
     <li><a href="/extensions.html">Our Extensions</a></li>
     <li><a href="/build.html">Building</a></li>
     
     <li><a href="/mpl.html">License</a></li>
   </ul></div></div></div><div class="clear"></div><div class="pageFooter"><div class="container"></div><div class="container"><div class="rabbit-logo"><a href="/"><img src="/img/logo-rabbitmq-white.svg" alt="RabbitMQ" /></a></div><ul class="footerNav"><li><a href="/#features">Features</a></li><li><a href="/#getstarted">Get Started</a></li><li><a href="/#support">Support</a></li><li><a href="/#community">Community</a></li><li><a href="/documentation.html">Docs</a></li></ul><p id="copyright">
          Copyright © 2007-2020 <a href="https://tanzu.vmware.com/">VMware</a>, Inc. or its affiliates. All rights reserved.
          <a href="https://pivotal.io/legal">Terms of Use</a>,
          <a href="https://pivotal.io/privacy-policy">Privacy</a> and
          <a href="/trademark-guidelines.html">Trademark Guidelines</a><br /><a id="teconsent"></a></p></div></div></div><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript">
        // code highlighting
        window.addEventListener("load", function() {
          const selectors = "pre.lang-bash, \
                             pre.lang-csharp, \
                             pre.lang-elixir, \
                             pre.lang-erlang, \
                             pre.lang-go, \
                             pre.lang-groovy, \
                             pre.lang-haskell, \
                             pre.lang-html, \
                             pre.lang-ini, \
                             pre.lang-java, \
                             pre.lang-javascript, \
                             pre.lang-json, \
                             pre.lang-makefile, \
                             pre.lang-objectivec, \
                             pre.lang-php, \
                             pre.lang-plaintext, \
                             pre.lang-powershell, \
                             pre.lang-python, \
                             pre.lang-ruby, \
                             pre.lang-swift, \
                             pre.lang-yaml, \
                             pre.lang-xml";
          document.querySelectorAll(selectors).forEach(function(el) {
            hljs.highlightBlock(el);
          });
        });
      </script></body>
</html>
